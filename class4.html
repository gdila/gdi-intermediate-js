<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Intermediate JavaScript</title>

		<meta name="description" content="Girl Develop It framework for easily creating beautiful presentations using HTML in GDI theme. Forked from Hakim El Hattab's reveal.js">
		<meta name="author" content="Girl Develop It">

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/simple.css" id="theme">

		<!-- For syntax highlighting -->
		<!-- light editor --><link rel="stylesheet" href="lib/css/light.css">
		<!-- dark editor <link rel="stylesheet" href="lib/css/dark.css">-->
		<!-- <link rel="stylesheet" href="lib/css/zenburn.css"> -->

		<link rel="stylesheet" href="plugin/accessibility-helper/css/accessibility-helper.css">

		<!-- If the query includes 'print-pdf', include the PDF print sheet -->
		<script>
			if( window.location.search.match( /print-pdf/gi ) ) {
				var link = document.createElement( 'link' );
				link.rel = 'stylesheet';
				link.type = 'text/css';
				link.href = 'css/print/pdf.css';
				document.getElementsByTagName( 'head' )[0].appendChild( link );
			}
		</script>

		<!-- If use the PDF print sheet so students can print slides-->

		<link rel="stylesheet" href="css/print/pdf.css" type="text/css" media="print">
		<link rel="icon" type="image/x-icon" href="favicon.ico" />
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>

	<body>

		<div class="reveal">

			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<!-- AJAX and JSON -->
				<section>
					<h3>JSON</h3>
					<ul>
						<li class="fragment">JSON = JavaScript Object Notation</li>
						<li class="fragment">A set of key/value pairs</li>
						<li class="fragment">Keys must be stored in quotes</li>
						<li class="fragment">Values can be Number, String, Boolean, Array, Object or null</li>
						<li class="fragment">Resembles objects, hash tables, or structs of programming languages</li>
						<li class="fragment">Can be validated at <a href="http://jsonlint.com/">JSONlint.com</a></li>
					</ul>
				</section>

				<section>
					<h3>Example JSON</h3>
<pre><code class="javascript">{
	"firstName": "Jane",
	"lastName": "Smith",
	"address": {
		"streetAddress": "425 2nd Street",
		"city": "San Francisco",
		"state": "CA",
		"postalCode": 94107
	},
	"phoneNumbers": [
		"212 732-1234",
		"646 123-4567" ]
}</code></pre>
				</section>

				<section>
					<h3>Moving JSON to the DOM</h3>
					<p>Start by storing JSON in a variable:</p>
<pre><code class="javascript">var myProfile = {
	"firstName": "Natalie",
	"lastName": "MacLees",
	"cats": ["Mabel", "Ollie"]};</code></pre>
					<p>Then, you can access the data stored inside and use it while creating new nodes:</p>
<pre><code class="javascript">var p = document.createElement('p');
p.innerHTML = 'My name is ' + myProfile.firstName + ' ' + myProfile.lastName + '. ';
p.innerHTML += 'My cats are ' + myProfile.cats.join(' and ') + '.';

var body = document.getElementsByTagName('body')[0];
body.appendChild(p);</code></pre>
				</section>

				<section>
					<h3>Let's Develop It!</h3>
					<p><a href="files/exercise-videoplayer.html" target="_new">Exercise instructions</a></p>
				</section>

				<section>
					<h2>Questions?</h2>
					<p>Questions about JSON?</p>
				</section>

				<section>
					<h3>Ajax</h3>
					<p>Asynchronous JavaScript And "XML"</p>
					<img src="img/ajax.png" height="400" width="600" alt="">
				</section>

				<section>
					<h3>Ajax in the wild</h3>
					<img src="img/wild-ajax.png" height="880" width="1136" alt="">
				</section>

				<section>
					<h3>Local server</h3>
					<p>We're going to start writing some ajax now.</p>
					<p>If you haven't already, get a local server running.</p>
					<p><a href="files/exercise-localserver.html" target="_new">Local Server Help</a></p>
				</section>

				<section>
					<h3>The <code>XMLHttpRequest</code> object</h3>
					<ul>
						<li>A native JavaScript object that can communicate asynchronously between the client and the server.</li>
						<li>To use it, we create a new instance of the object:
<pre><code class="javascript">var request = new XMLHttpRequest();</code></pre>
						</li>
						<li>...and then use the properties and methods of that object to make an ajax call</li>
					</ul>
				</section>

				<section>
					<h3>Getting ready to communicate</h3>
					<p>Now that we've created an instance of the XHR object, it needs to be prepped for communication. That requires three things:</p>
					<ol>
						<li>The <code>readystatechange</code> event handler</li>
						<li>The <code>open()</code> method</li>
						<li>The <code>send()</code> method</li>
					</ol>
				</section>

				<section>
					<h3><code>readystatechange</code></h3>
					<ul>
						<li>During an ajax operation, the server sends updates to the client about the current status of the communication by updating a property of the XHR object called <code>readyState</code>.</li>
						<li class="fragment">Each time the <code>readyState</code> property is changed, the <code>readystatechange</code> event is fired.</li>
						<li class="fragment">If you add an event listener function to the <code>readystatechange</code> event, your function will execute each time the server pings the client with an update.</li>
					</ul>
				</section>

				<section>
					<h3>An <code>onreadystatechange</code> example</h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

if(request) {
	request.addEventListener('readystatechange', function(){
		console.log(request.readyState);
	});
}</code></pre>
				</section>

				<section>
					<h3>The <code>open()</code> method</h3>
					<div class="left-align">
						<p>The <code>open()</code> method takes two required arguments:</p>
						<ol>
							<li>The type of request (string)</li>
							<li>The location of the file on the server (string)</li>
						</ol>
						<p>&nbsp;</p>
						<p>And an additional optional argument:</p>
						<ol>
							<li>Whether or not the request should be asynchronous (Boolean)</li>
						</ol>
					</div>
				</section>

				<section>
					<h3>The <code>open()</code> method</h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

if(request) {
	request.addEventListener('readystatechange', function(){
		console.log(request.readyState);
	});
	request.open('GET', 'me.json', true);
}</code></pre>
					<p>Here's a <a href="files/me.json">me.json</a> file you can include in your project to call.</p>
				</section>


				<section>
					<h3>Request types: <code>GET</code> and <code>POST</code></h3>
					<dl>
						<dt><code>GET</code></dt>
						<dd>
							<ul>
								<li>Most commonly used</li>
								<li>When you just want to retrieve a file from the server and you don't need to send any data</li>
								<li>Also capable of sending a small amount of data as a query string</li>
							</ul>
						</dd>
						<dt><code>POST</code></dt>
						<dd>
							<ul>
								<li>Useful for sending a lot of data to the server</li>
							</ul>
						</dd>
					</dl>
					<p><small>Just FYI, there are some other request types too (<code>PUT</code>, <code>DELETE</code>, and <code>HEAD</code>, for example), but they're not a concern for the stuff we're doing.</small></p>
				</section>

				<section>
					<h3>Location of the file</h3>
					<ul>
						<li>A string that contains either a relative, absolute, or full path to a file on the server</li>
						<li>The file you are requesting must reside in the same domain as the JavaScript file that is making the request.</li>
					</ul>
				</section>

				<section>
					<h3>Cross Domain Policy</h3>
					<p>If we're on this page:</p>
					<p>http://store.company.com/dir/page.html</p>
					<p>Here's how these ajax requests will work out:</p>
					<table>
						<thead>
							<tr>
								<th>URL</th>
								<th>Outcome</th>
								<th>Reason</th>
							</tr>
						</thead>
						<tbody>
							<tr class="success">
								<td>http://store.company.com/dir2/other.html</td>
								<td>Success</td>
								<td></td>
							</tr>
							<tr class="success">
								<td>http://store.company.com/dir/inner/other.html</td>
								<td>Success</td>
								<td></td>
							</tr>
							<tr class="failure">
								<td>https://store.company.com/secure.html</td>
								<td>Failure</td>
								<td>Different protocol</td>
							</tr>
							<tr class="failure">
								<td>http://store.company.com:81/dir/etc.html</td>
								<td>Failure</td>
								<td>Different port</td>
							</tr>
							<tr class="failure">
								<td>http://news.company.com/dir/other.html</td>
								<td>Failure</td>
								<td>Different host</td>
							</tr>
							<tr class="failure">
								<td>http://google.com</td>
								<td>Failure</td>
								<td>Different host</td>
							</tr>
						</tbody>
					</table>
				</section>

				<section>
					<h3>Asynchronous</h3>
					<p>Indicates whether the request should occur asynchronously or not.</p>
					<p>If <code>true</code>, the script will make the request and won't wait for the response from the server before moving on to the rest of the script.</p>
					<p>If <code>false</code>, the browser will stop processing the script until the ajax request is completed.</p>
					<p>&nbsp;</p>
					<p>Use <code>true</code>!</p>
				</section>

				<section>
					<h3>The <code>send()</code> method</h3>
					<p>Once your request is prepped by the <code>open()</code> method, it's ready to be sent!</p>
				</section>

				<section>
					<h3><code>send()</code> using <code>GET</code></h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

if(request) {
	request.addEventListener('readystatechange', function(){
		console.log(request.readyState);
	});
	request.open('GET', 'me.json', true);
	request.send();
}</code></pre>
					<p>Here's a <a href="files/me.json">me.json</a> file you can include in your project to call.</p>
				</section>

				<section>
					<h3><code>POST</code>: The <code>setRequestHeader()</code> method</h3>
					<p>Since we're sending data with the <code>POST</code> type, we have an extra step. We need to use the <code>setRequestHeader</code> method of the XHR object to set the request headers.</p>
					<p>Request headers are bits of metadata that describe the request so the server understands what to expect from the data received.</p>
					<p><code>setRequestHeader()</code> takes two arguments:</p>
					<ol>
						<li>Name of the header (string)</li>
						<li>Value of the header (string)</li>
					</ol>
				</section>

				<section>
					<h3><code>setRequestHeader()</code> example</h3>
					<p>If you are sending data to the server, you need to set the value of the <code>Content-type</code> header to <code>application/x-www-form-urlencoded</code>, like this:</p>
<pre><code class="javascript">request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');</code></pre>
					<p>This tells the server to expect some data and for that data to be URL-encoded.</p>
					<p><span class="blue">URL-encoded</span> means spaces become plus signs (+) and non-alphanumeric characters need to be encoded as <a href="http://www.degraeve.com/reference/urlencoding.php">hex values</a>.</span></p>
<pre><code class="javascript">'name=Natalie+MacLees&message=JavaScript+is+awesome%21'</code></pre>
				</section>

				<section>
					<h3><code>send()</code> using <code>POST</code></h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

if(request) {
	request.addEventListener('readystatechange', function(){
		console.log(request.readyState);
	});
	request.open('POST', 'me.php', true);
	request.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
	request.send('name=Natalie+MacLees&message=JavaScript+is+awesome%21');
}</code></pre>
				</section>

				<section>
					<h3>Let's Develop It!</h3>
					<p>In your project folder, create a simple <code>.txt</code> file with a sentence of plain text in it.</p>
					<p>Next, set up a new XHR object and get the file. Use the console tools to view the request.</p>
				</section>

				<section>
					<h3>Receiving a response</h3>
					<p>Phew! Now we've got sending a request down - let's learn how to receive a response!</p>
				</section>

				<section>
					<h3>The <code>readyState</code> property</h3>
					<p>Indicates the current state of the Ajax request. Possible values:</p>
					<ul>
						<li><code>0</code> - Uninitialized. The open method hasn't been called yet.</li>
						<li><code>1</code> - Loading. The open method has been called.</li>
						<li><code>2</code> - Loaded. The send method has been called - the request has begun</li>
						<li><code>3</code> - Interactive. The server is working on it</li>
						<li><code>4</code> - Complete. The server sent a response.</li>
					</ul>
				</section>

				<section>
					<h3><code>readyState</code> property and the <code>readyStateChange</code> event</h3>
					<p>In theory, the readyState property counts from 0 to 4 in order.</p>
					<p>In practice, what happens is a bit unpredictable.</p>
					<p>What we <em>can</em> count on is that if the value has reached <code>4</code>, the server has finished sending a response.</p>
				</section>

				<section>
					<h3>Checking the <code>readyState</code></h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

var doSomething = function() {
	if (request.readyState == 4) {
		console.log('The request is complete!');
		//do something with the response here
	}
}

if(request) {
	request.addEventListener('readystatechange', doSomething);
	request.open('GET', 'me.json', true);
	request.send();
}</code></pre>
					<p><code>doSomething()</code> gets called every time the value of the <code>readyState</code> property changes, but our <code>if</code> statement ensures nothing will happen unless the value is <code>4</code>.</p>
				</section>

				<section>
					<h3>Status</h3>
					<p>When the server sends back a response, it always includes response headers with metadata about the response.</p>
					<p>These headers include a <span class="blue">status code</span> - a three digit number that is part of the HTTP protocol</p>
					<p>Some examples:</p>
					<ul>
						<li><code>404</code> - not found</li>
						<li><code>403</code> - forbidden</li>
						<li><code>500</code> - internal server error</li>
					</ul>
				</section>

				<section>
					<h3>200 OK</h3>
					<p>The most common status code is <code>200</code>, which means <code>OK</code>. It indicates the response was successfully sent.</p>
					<p>The XHR object has a property called <code>status</code> where the status code is stored. We can check it to make sure we got a successful response:</p>
<pre><code class="javascript">var doSomething = function() {
	if(request.readyState == 4) {
		if(request.status == 200) {
			console.log('The request is complete and ok.');
			//do something with the response here
		}
	}
}</code></pre>
				</section>

				<section>
					<h3>When things don't go as planned...</h3>
					<p>We can also add an <code>else</code> statement to deal with situations where things don't go according to plan:</p>
<pre><code class="javascript">var doSomething = function() {
	if(request.readyState == 4) {
		if(request.status == 200) {
			console.log('The request is complete and ok.');
			//do something with the response here
		} else {
			//something went wrong
		}
	}
}</code></pre>
				</section>

				<section>
					<h3>The <code>responseText</code> property</h3>
					<p>The <code>responseText</code> property of the XHR object contains the data sent from the server as a string.</p>
<pre><code class="javascript">var doSomething = function() {
	if(request.readyState == 4) {
		if(request.status == 200) {
			console.log(request.responseText);
		}
	}
}</code></pre>
				</section>

				<section>
					<h3>But we need JSON!</h3>
					<p>The <code>responseText</code> property contains our data, but it's a string, and we need JSON. We just need to convert it to JSON like this:</p>
<pre><code class="javascript">var jsonObj = JSON.parse(request.responseText);</code></pre>
				</section>

				<section>
					<h3>Putting it all together</h3>
					<p>Let's step through fetching some information from the server with ajax and displaying it on our page.</p>
				</section>

				<section>
					<h3>First, we need to create, prep, and send our request:</h3>
<pre><code class="javascript">var request = new XMLHttpRequest();

var displayResponse = function(){
	// we'll write some code here later
};

if (request) {
	request.addEventListener('readystatechange', displayResponse);
	request.open('GET', 'me.json', true);
	request.send();
}</code></pre>
				</section>

				<section>
					<h3>Next, we need a place in our HTML to display the results:</h3>
<pre><code class="xml">&lt;div id="resultsBox"&gt;&lt;/div&gt;</code></pre>
				</section>

				<section>
					<h3>Then, we'll handle the response</h3>
<pre><code class="javascript">var displayResponse = function(){
	if (request.readyState == 4) {
		if (request.status == 200) {
			var jsonObj = JSON.parse(request.responseText);

			var p = document.createElement('p');
			p.innerHTML = 'My name is ' + jsonObj.firstName + ' ' + jsonObj.lastName + ' and I live at ' + jsonObj.address.streetAddress + ' in ' + jsonObj.address.city + '. ';
			p.innerHTML += 'My zip code is ' + jsonObj.address.postalCode + '.';

			var displayBox = document.getElementById('resultsBox');

			displayBox.appendChild(p);
		}
	}
};</code></pre>
					<p>We're using what we already learned about dealing with JSON!</p>
				</section>

				<section>
					<h3>Let's Develop It!</h3>
					<p><a href="files/exercise-ajaxvideoplayer.html" target="_new">Exercise Instructions</a></p>
				</section>

				<section>
					<h3>Ajax</h3>
					<p>The <code>XMLHttpRequest</code> is the heart and soul of ajax. Its methods and properties drive the requests that make ajax feel so responsive.</p>
				</section>

				<section>
					<h3>Things to keep in mind</h3>
					<ul>
						<li>Cross domain requests are restricted.</li>
						<li>Multiple ajax requests don't return in the same order they were sent.</li>
					</ul>
				</section>

				<section>
					<h2>Questions?</h2>
					<p>Questions about JSON or Ajax before we wrap up?</p>
				</section>

				<section>
					<h3>Survey</h3>
					<p>We strive to make every class better than the last. We rely on your honest feedback to make our classes better. Please take a moment to complete the <a href="https://goo.gl/forms/iuW3ub22NZ566Vrl1">survey</a> for this class.</p>
					<p><a href="https://goo.gl/forms/iuW3ub22NZ566Vrl1">Take the survey</a></p>
				</section>

				<section>
					<h3>Thank you!</h3>
					<p>As you keep working with JavaScript, if you have questions or get stuck, post in our <a href="http://facebook.com/groups/gdila">Facebook group</a> and we'll help you out!.</p>
				</section>
			</div>
			<footer>
				<div class="copyright">
					Intermediate JavaScript -- Los Angeles --
					<a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/deed.en_US"><img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/80x15.png" /></a>
				</div>
			</footer>
		</div>


		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
						Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				transition: 'slide', // none/fade/slide/convex/concave/zoom

				// Optional reveal.js plugins
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true },
										{ src: 'plugin/accessibility-helper/js/accessibility-helper.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
